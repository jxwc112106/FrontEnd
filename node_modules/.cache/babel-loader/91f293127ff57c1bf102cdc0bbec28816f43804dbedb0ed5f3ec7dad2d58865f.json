{"ast":null,"code":"import _toConsumableArray from \"/root/FrontPlatform/vue-front/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/root/FrontPlatform/vue-front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { toRefs, ref, watchEffect, watch, nextTick } from \"vue\";\nimport { on, off } from \"../../_utils/dom.js\";\nimport getFixTranslate from \"../utils/get-fix-translate.js\";\nfunction useImageDrag(props) {\n  var _toRefs = toRefs(props),\n    wrapperEl = _toRefs.wrapperEl,\n    imageEl = _toRefs.imageEl,\n    scale = _toRefs.scale;\n  var translate = ref([0, 0]);\n  var moving = ref(false);\n  var startPageX = 0;\n  var startPageY = 0;\n  var startTranslate = [0, 0];\n  var checkAndFixTranslate = function checkAndFixTranslate() {\n    if (!wrapperEl.value || !imageEl.value) return;\n    var wrapperRect = wrapperEl.value.getBoundingClientRect();\n    var imgRect = imageEl.value.getBoundingClientRect();\n    var _getFixTranslate = getFixTranslate(wrapperRect, imgRect, translate.value[0], translate.value[1], scale.value),\n      _getFixTranslate2 = _slicedToArray(_getFixTranslate, 2),\n      x = _getFixTranslate2[0],\n      y = _getFixTranslate2[1];\n    if (x !== translate.value[0] || y !== translate.value[1]) {\n      translate.value = [x, y];\n    }\n  };\n  var onMoving = function onMoving(e) {\n    e.preventDefault && e.preventDefault();\n    var nextX = startTranslate[0] + (e.pageX - startPageX) / scale.value;\n    var nextY = startTranslate[1] + (e.pageY - startPageY) / scale.value;\n    translate.value = [nextX, nextY];\n  };\n  var onMoveEnd = function onMoveEnd(e) {\n    e.preventDefault && e.preventDefault();\n    moving.value = false;\n    checkAndFixTranslate();\n    offEvents();\n  };\n  var onMoveStart = function onMoveStart(e) {\n    if (e.target !== e.currentTarget) return;\n    e.preventDefault && e.preventDefault();\n    moving.value = true;\n    startPageX = e.pageX;\n    startPageY = e.pageY;\n    startTranslate = _toConsumableArray(translate.value);\n    on(window, \"mousemove\", onMoving, false);\n    on(window, \"mouseup\", onMoveEnd, false);\n  };\n  function offEvents() {\n    off(window, \"mousemove\", onMoving, false);\n    off(window, \"mouseup\", onMoveEnd, false);\n  }\n  watchEffect(function (onInvalidate) {\n    imageEl.value && on(imageEl.value, \"mousedown\", onMoveStart);\n    onInvalidate(function () {\n      imageEl.value && off(imageEl.value, \"mousedown\", onMoveStart);\n      offEvents();\n    });\n  });\n  watch([scale], function () {\n    nextTick(function () {\n      return checkAndFixTranslate();\n    });\n  });\n  return {\n    translate: translate,\n    moving: moving,\n    resetTranslate: function resetTranslate() {\n      translate.value = [0, 0];\n    }\n  };\n}\nexport { useImageDrag as default };","map":{"version":3,"names":["toRefs","ref","watchEffect","watch","nextTick","on","off","getFixTranslate","useImageDrag","props","_toRefs","wrapperEl","imageEl","scale","translate","moving","startPageX","startPageY","startTranslate","checkAndFixTranslate","value","wrapperRect","getBoundingClientRect","imgRect","_getFixTranslate","_getFixTranslate2","_slicedToArray","x","y","onMoving","e","preventDefault","nextX","pageX","nextY","pageY","onMoveEnd","offEvents","onMoveStart","target","currentTarget","_toConsumableArray","window","onInvalidate","resetTranslate","default"],"sources":["/root/FrontPlatform/vue-front/node_modules/@arco-design/web-vue/es/image/hooks/use-image-drag.js"],"sourcesContent":["import { toRefs, ref, watchEffect, watch, nextTick } from \"vue\";\nimport { on, off } from \"../../_utils/dom.js\";\nimport getFixTranslate from \"../utils/get-fix-translate.js\";\nfunction useImageDrag(props) {\n  const { wrapperEl, imageEl, scale } = toRefs(props);\n  const translate = ref([0, 0]);\n  const moving = ref(false);\n  let startPageX = 0;\n  let startPageY = 0;\n  let startTranslate = [0, 0];\n  const checkAndFixTranslate = () => {\n    if (!wrapperEl.value || !imageEl.value)\n      return;\n    const wrapperRect = wrapperEl.value.getBoundingClientRect();\n    const imgRect = imageEl.value.getBoundingClientRect();\n    const [x, y] = getFixTranslate(wrapperRect, imgRect, translate.value[0], translate.value[1], scale.value);\n    if (x !== translate.value[0] || y !== translate.value[1]) {\n      translate.value = [x, y];\n    }\n  };\n  const onMoving = (e) => {\n    e.preventDefault && e.preventDefault();\n    const nextX = startTranslate[0] + (e.pageX - startPageX) / scale.value;\n    const nextY = startTranslate[1] + (e.pageY - startPageY) / scale.value;\n    translate.value = [nextX, nextY];\n  };\n  const onMoveEnd = (e) => {\n    e.preventDefault && e.preventDefault();\n    moving.value = false;\n    checkAndFixTranslate();\n    offEvents();\n  };\n  const onMoveStart = (e) => {\n    if (e.target !== e.currentTarget)\n      return;\n    e.preventDefault && e.preventDefault();\n    moving.value = true;\n    startPageX = e.pageX;\n    startPageY = e.pageY;\n    startTranslate = [...translate.value];\n    on(window, \"mousemove\", onMoving, false);\n    on(window, \"mouseup\", onMoveEnd, false);\n  };\n  function offEvents() {\n    off(window, \"mousemove\", onMoving, false);\n    off(window, \"mouseup\", onMoveEnd, false);\n  }\n  watchEffect((onInvalidate) => {\n    imageEl.value && on(imageEl.value, \"mousedown\", onMoveStart);\n    onInvalidate(() => {\n      imageEl.value && off(imageEl.value, \"mousedown\", onMoveStart);\n      offEvents();\n    });\n  });\n  watch([scale], () => {\n    nextTick(() => checkAndFixTranslate());\n  });\n  return {\n    translate,\n    moving,\n    resetTranslate() {\n      translate.value = [0, 0];\n    }\n  };\n}\nexport { useImageDrag as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}